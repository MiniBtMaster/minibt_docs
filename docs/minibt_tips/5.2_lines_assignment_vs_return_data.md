# MiniBT 指标构造：lines 赋值 vs 返回数据 两种方法使用技巧
在 MiniBT 框架中构建自定义指标（继承 `BtIndicator`）时，核心有两种规范的指标数据输出方式（对应 `G_Channels` 指标代码），两种方法对指标构造效果一样：

## 一、核心方法1：`self.lines` 赋值法
### 1. 方法原理
通过直接给 `self.lines` 绑定属性（如 `self.lines.a`、`self.lines.zig`），将计算后的指标数据赋值给框架内置的线对象，该指标实例化后可像内置指标一样，通过 `指标实例.线名称`（如 `g_channels.a`、`g_channels.avg`）便捷访问数据，支持 `new`/`prev` 便捷属性和负数索引。

### 2. 代码示例
```python
from minibt import BtIndicator

class G_Channels(BtIndicator):
    """✈ https://www.tradingview.com/script/fIvlS64B-G-Channels-Efficient-Calculation-Of-Upper-Lower-Extremities/"""
    params = dict(length=144., cycle=1, thresh=0.)
    overlap = True  # 标记为重叠指标（与K线同坐标系显示）

    def next(self):
        # 1. 参数初始化
        length = self.params.length
        cycle = max(int(self.params.cycle), 1)
        size = self.close.size
        a = self.full()  # 获取与K线长度一致的空数组
        b = self.full()
        close = self.close.values
        pre_a = 0.
        pre_b = 0.

        # 2. 核心指标计算
        for i in range(size):
            if i and i % cycle == 0:
                a[i] = max(close[i], pre_a)-(pre_a-pre_b) / length
                b[i] = min(close[i], pre_b)+(pre_a-pre_b) / length
                pre_a = a[i]
                pre_b = b[i]
        if cycle > 1:
            a = a.interpolate()  # 插值补全缺失数据
            b = b.interpolate()
        avg = (a+b)/2.

        # 3. self.lines 赋值：绑定指标线
        self.lines.a = a  # 上轨线
        self.lines.b = b  # 下轨线
        self.lines.avg = avg  # 中轨线（平均值）

        # 可选：根据阈值额外添加zigzag指标线
        if 0. < self.params.thresh < 1.:
            self.lines.zig = self.btind.zigzag_full(self.params.thresh)
```

## 二、核心方法2：返回数据法
### 1. 方法原理
在 `next` 方法中不使用 `self.lines` 赋值，而是直接将计算后的指标数据以元组/列表形式返回，该方法无需绑定线对象，更轻量化，适用于仅在当前策略内部临时使用的指标，无需对外暴露。

### 2. 代码示例
```python
from minibt import BtIndicator

class G_Channels(BtIndicator):
    """✈ https://www.tradingview.com/script/fIvlS64B-G-Channels-Efficient-Calculation-Of-Upper-Lower-Extremities/"""
    params = dict(length=144., cycle=1, thresh=0.)
    overlap = True

    def next(self):
        # 1. 参数初始化与核心计算（与方法1完全一致）
        length = self.params.length
        cycle = max(int(self.params.cycle), 1)
        size = self.close.size
        a = self.full()
        b = self.full()
        close = self.close.values
        pre_a = 0.
        pre_b = 0.

        for i in range(size):
            if i and i % cycle == 0:
                a[i] = max(close[i], pre_a)-(pre_a-pre_b) / length
                b[i] = min(close[i], pre_b)+(pre_a-pre_b) / length
                pre_a = a[i]
                pre_b = b[i]
        if cycle > 1:
            a = a.interpolate()
            b = b.interpolate()
        avg = (a+b)/2.

        # 2. 返回数据法：无self.lines赋值，直接返回指标数据
        if 0. < self.params.thresh < 1.:
            zig = self.btind.zigzag_full(self.params.thresh)
            return a, b, avg, zig  # 多指标数据以元组形式返回
        return a, b, avg  # 基础指标数据返回
```
